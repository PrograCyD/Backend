basePath: /
definitions:
  handler.loginRequest:
    properties:
      email:
        type: string
      password:
        type: string
    type: object
  handler.ratingRequest:
    properties:
      movieId:
        type: integer
      rating:
        type: number
    type: object
  handler.registerRequest:
    properties:
      about:
        type: string
      email:
        type: string
      firstName:
        type: string
      lastName:
        type: string
      password:
        type: string
      preferredGenres:
        items:
          type: string
        type: array
      role:
        type: string
      username:
        type: string
    type: object
  handler.updateUserRequest:
    properties:
      about:
        type: string
      email:
        type: string
      firstName:
        type: string
      lastName:
        type: string
      password:
        type: string
      preferredGenres:
        items:
          type: string
        type: array
      role:
        type: string
      username:
        type: string
    type: object
  handler.userResponse:
    properties:
      about:
        type: string
      createdAt:
        type: string
      email:
        type: string
      firstName:
        type: string
      lastName:
        type: string
      preferredGenres:
        items:
          type: string
        type: array
      role:
        type: string
      uIdx:
        type: integer
      updatedAt:
        type: string
      userId:
        type: integer
      username:
        type: string
    type: object
  models.AdminPendingSimilarities:
    properties:
      minRatings:
        type: integer
      withoutIdx:
        items:
          $ref: '#/definitions/models.PendingMovieWithoutIdx'
        type: array
      withoutSimilarities:
        items:
          $ref: '#/definitions/models.PendingMovieWithoutSims'
        type: array
    type: object
  models.AdminSimilaritySummary:
    properties:
      minRatings:
        type: integer
      moviesWithIdx:
        type: integer
      moviesWithSimilarities:
        type: integer
      moviesWithoutIdx:
        type: integer
      moviesWithoutSimilarities:
        type: integer
      totalMovies:
        type: integer
    type: object
  models.CastMember:
    properties:
      name:
        type: string
      profileUrl:
        type: string
    type: object
  models.ExternalData:
    properties:
      budget:
        type: integer
      cast:
        items:
          $ref: '#/definitions/models.CastMember'
        type: array
      director:
        type: string
      overview:
        type: string
      posterUrl:
        type: string
      revenue:
        type: integer
      runtime:
        type: integer
      tmdbFetched:
        type: boolean
    type: object
  models.GenomeTag:
    properties:
      relevance:
        type: number
      tag:
        type: string
    type: object
  models.Links:
    properties:
      imdb:
        type: string
      movielens:
        type: string
      tmdb:
        type: string
    type: object
  models.MovieCreateRequest:
    properties:
      cast:
        description: ExternalData.Cast
        items:
          $ref: '#/definitions/models.CastMember'
        type: array
      director:
        description: ExternalData.Director
        type: string
      genomeTags:
        items:
          $ref: '#/definitions/models.GenomeTag'
        type: array
      genres:
        items:
          type: string
        type: array
      links:
        $ref: '#/definitions/models.Links'
      overview:
        description: ExternalData
        type: string
      posterUrl:
        description: ExternalData.PosterURL
        type: string
      runtime:
        description: ExternalData.Runtime
        type: integer
      title:
        description: obligatorio
        type: string
      userTags:
        items:
          type: string
        type: array
      year:
        type: integer
    type: object
  models.MovieDoc:
    properties:
      createdAt:
        type: string
      externalData:
        $ref: '#/definitions/models.ExternalData'
      genomeTags:
        items:
          $ref: '#/definitions/models.GenomeTag'
        type: array
      genres:
        items:
          type: string
        type: array
      iIdx:
        type: integer
      links:
        $ref: '#/definitions/models.Links'
      movieId:
        type: integer
      ratingStats:
        $ref: '#/definitions/models.RatingStats'
      title:
        type: string
      updatedAt:
        type: string
      userTags:
        items:
          type: string
        type: array
      year:
        type: integer
    type: object
  models.MovieRequest:
    properties:
      approvedMovieId:
        type: integer
      createdAt:
        type: string
      id:
        type: string
      movie:
        $ref: '#/definitions/models.MovieCreateRequest'
      reason:
        type: string
      status:
        description: pending|approved|rejected
        type: string
      updatedAt:
        type: string
      userId:
        type: integer
    type: object
  models.MovieUpdateRequest:
    properties:
      cast:
        items:
          $ref: '#/definitions/models.CastMember'
        type: array
      director:
        type: string
      genomeTags:
        items:
          $ref: '#/definitions/models.GenomeTag'
        type: array
      genres:
        items:
          type: string
        type: array
      links:
        $ref: '#/definitions/models.Links'
      overview:
        type: string
      posterUrl:
        type: string
      runtime:
        type: integer
      title:
        type: string
      userTags:
        items:
          type: string
        type: array
      year:
        type: integer
    type: object
  models.PendingMovieWithoutIdx:
    properties:
      movieId:
        type: integer
      ratingsCount:
        type: integer
      title:
        type: string
    type: object
  models.PendingMovieWithoutSims:
    properties:
      iIdx:
        type: integer
      movieId:
        type: integer
      ratingsCount:
        type: integer
      title:
        type: string
    type: object
  models.RatingStats:
    properties:
      average:
        type: number
      count:
        type: integer
      lastRatedAt:
        type: string
    type: object
  models.RebuildSimilaritiesRequest:
    properties:
      batchSize:
        type: integer
      k:
        type: integer
      minCommonUsers:
        type: integer
      minRatings:
        type: integer
      parallelism:
        type: integer
      shrink:
        type: integer
    type: object
  models.RebuildSimilaritiesResult:
    properties:
      batches:
        type: integer
      k:
        type: integer
      minCommonUsers:
        type: integer
      processedMovies:
        type: integer
      shrink:
        type: integer
    type: object
  models.RecItem:
    properties:
      movieId:
        type: integer
      score:
        type: number
    type: object
  models.RejectMovieRequest:
    properties:
      reason:
        type: string
    type: object
  models.RemapMissingRequest:
    properties:
      limit:
        type: integer
      minRatings:
        type: integer
    type: object
  models.RemapMissingResult:
    properties:
      fromIdx:
        type: integer
      mappedCount:
        type: integer
      toIdx:
        type: integer
    type: object
host: localhost:8080
info:
  contact: {}
  description: API para PC4 (item-based, Mongo, Redis)
  title: NodosML Movie Recommender API
  version: "1.0"
paths:
  /admin/maintenance/similarities/pending:
    get:
      description: Lista películas sin iIdx y películas con iIdx pero sin documento
        en similarities.
      parameters:
      - description: Mínimo de ratings para considerar una película (default 5)
        in: query
        name: minRatings
        type: integer
      - description: Límite de películas sin iIdx (default 50)
        in: query
        name: limitWithoutIdx
        type: integer
      - description: Límite de películas sin similitudes (default 50)
        in: query
        name: limitWithoutSims
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.AdminPendingSimilarities'
        "500":
          description: error interno
          schema:
            type: string
      security:
      - BearerAuth: []
      summary: Películas pendientes de mapeo/similitudes
      tags:
      - admin-maintenance
  /admin/maintenance/similarities/rebuild:
    post:
      consumes:
      - application/json
      description: Lanza el recálculo de similitudes en batches contra los nodos ML
        para películas sin entry en similarities.
      parameters:
      - description: Parámetros de reconstrucción
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.RebuildSimilaritiesRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.RebuildSimilaritiesResult'
        "400":
          description: body inválido
          schema:
            type: string
        "500":
          description: error interno
          schema:
            type: string
      security:
      - BearerAuth: []
      summary: Recalcular similitudes pendientes
      tags:
      - admin-maintenance
  /admin/maintenance/similarities/remap-missing:
    post:
      consumes:
      - application/json
      description: Asigna nuevos valores de iIdx a películas que aún no lo tienen
        y tienen suficientes ratings.
      parameters:
      - description: Parámetros de remapeo
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.RemapMissingRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.RemapMissingResult'
        "400":
          description: body inválido
          schema:
            type: string
        "500":
          description: error interno
          schema:
            type: string
      security:
      - BearerAuth: []
      summary: Remapear películas sin iIdx
      tags:
      - admin-maintenance
  /admin/maintenance/similarities/summary:
    get:
      description: Devuelve conteos de películas con/sin iIdx y con/sin similitudes
        precalculadas.
      parameters:
      - description: Mínimo de ratings para considerar una película (default 5)
        in: query
        name: minRatings
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.AdminSimilaritySummary'
        "500":
          description: error interno
          schema:
            type: string
      security:
      - BearerAuth: []
      summary: Resumen de estado de similitudes
      tags:
      - admin-maintenance
  /admin/movie-requests:
    get:
      parameters:
      - description: 'pending|approved|rejected|all (default: pending)'
        in: query
        name: status
        type: string
      - description: 'límite (default: 20)'
        in: query
        name: limit
        type: integer
      - description: 'offset (default: 0)'
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.MovieRequest'
            type: array
      security:
      - BearerAuth: []
      summary: Listar requests de películas (admin)
      tags:
      - movie-requests
  /admin/movie-requests/{id}/approve:
    post:
      consumes:
      - application/json
      parameters:
      - description: movieRequestId (ObjectID)
        in: path
        name: id
        required: true
        type: string
      - description: Override opcional de datos
        in: body
        name: body
        schema:
          $ref: '#/definitions/models.MovieCreateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
      security:
      - BearerAuth: []
      summary: Aprobar request de película
      tags:
      - movie-requests
  /admin/movie-requests/{id}/reject:
    post:
      consumes:
      - application/json
      parameters:
      - description: movieRequestId (ObjectID)
        in: path
        name: id
        required: true
        type: string
      - description: Motivo de rechazo
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.RejectMovieRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.MovieRequest'
      security:
      - BearerAuth: []
      summary: Rechazar request de película
      tags:
      - movie-requests
  /admin/movies:
    post:
      consumes:
      - application/json
      parameters:
      - description: Datos de la película
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.MovieCreateRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/models.MovieDoc'
      security:
      - BearerAuth: []
      summary: Crear nueva película
      tags:
      - movies
  /admin/movies/{id}:
    put:
      consumes:
      - application/json
      parameters:
      - description: movieId
        in: path
        name: id
        required: true
        type: integer
      - description: Campos a actualizar
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.MovieUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.MovieDoc'
      security:
      - BearerAuth: []
      summary: Actualizar película existente
      tags:
      - movies
  /auth/login:
    post:
      consumes:
      - application/json
      parameters:
      - description: credenciales
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.loginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
      summary: Login
      tags:
      - auth
  /auth/register:
    post:
      consumes:
      - application/json
      description: Crea un usuario nuevo
      parameters:
      - description: datos
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.registerRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Register
      tags:
      - auth
  /health:
    get:
      responses:
        "200":
          description: OK
      summary: Healthcheck
      tags:
      - health
  /me/movie-requests:
    get:
      parameters:
      - description: 'pending|approved|rejected|all (default: pending)'
        in: query
        name: status
        type: string
      - description: 'límite (default: 20)'
        in: query
        name: limit
        type: integer
      - description: 'offset (default: 0)'
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.MovieRequest'
            type: array
      security:
      - BearerAuth: []
      summary: Listar mis requests de película
      tags:
      - movie-requests
    post:
      consumes:
      - application/json
      parameters:
      - description: Datos propuestos de película
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.MovieCreateRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/models.MovieRequest'
      security:
      - BearerAuth: []
      summary: Crear request de nueva película
      tags:
      - movie-requests
  /me/ratings:
    get:
      produces:
      - application/json
      responses: {}
      security:
      - BearerAuth: []
      summary: Listar MIS ratings
      tags:
      - ratings
    post:
      consumes:
      - application/json
      parameters:
      - description: rating
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.ratingRequest'
      responses:
        "204":
          description: No Content
      security:
      - BearerAuth: []
      summary: Crear/actualizar mis ratings
      tags:
      - ratings
  /me/recommendations:
    get:
      parameters:
      - description: cantidad de recomendaciones (máx 50)
        in: query
        name: k
        type: integer
      - description: si true, ignora cache Redis
        in: query
        name: refresh
        type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.RecItem'
            type: array
      security:
      - BearerAuth: []
      summary: Mis recomendaciones
      tags:
      - recommend
  /movies/{id}:
    get:
      parameters:
      - description: movieId
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.MovieDoc'
      summary: Get movie
      tags:
      - movies
  /movies/search:
    get:
      parameters:
      - description: búsqueda por título
        in: query
        name: q
        type: string
      - description: filtrar por género
        in: query
        name: genre
        type: string
      - description: año desde
        in: query
        name: year_from
        type: integer
      - description: año hasta
        in: query
        name: year_to
        type: integer
      - description: límite
        in: query
        name: limit
        type: integer
      - description: offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.MovieDoc'
            type: array
      summary: Buscar / listar películas (paginado)
      tags:
      - movies
  /movies/tmdb:
    get:
      parameters:
      - description: ID de TMDB, por ejemplo 603
        in: query
        name: tmdbId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.ExternalData'
        "400":
          description: tmdbId requerido
          schema:
            type: string
      summary: Obtener datos de película desde TMDB (para prellenar formulario)
      tags:
      - movies
  /movies/tmdb-prefill:
    get:
      parameters:
      - description: ID de TMDB, por ejemplo 603
        in: query
        name: tmdbId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.MovieCreateRequest'
        "400":
          description: tmdbId requerido
          schema:
            type: string
      summary: Prefill de película completo desde TMDB (para formulario de alta)
      tags:
      - movies
  /movies/top:
    get:
      parameters:
      - description: 'popular|rating (default: popular)'
        in: query
        name: metric
        type: string
      - description: 'límite (default: 20)'
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.MovieDoc'
            type: array
      summary: Top películas (popularidad o rating)
      tags:
      - movies
  /users:
    get:
      parameters:
      - description: 'user|admin|all (default: all)'
        in: query
        name: role
        type: string
      - description: búsqueda por email/username/nombre
        in: query
        name: q
        type: string
      - description: 'límite (default: 20)'
        in: query
        name: limit
        type: integer
      - description: 'offset (default: 0)'
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/handler.userResponse'
            type: array
      security:
      - BearerAuth: []
      summary: Listar usuarios (ADMIN)
      tags:
      - users
  /users/{id}:
    get:
      parameters:
      - description: userId
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handler.userResponse'
      security:
      - BearerAuth: []
      summary: Obtener usuario por id (ADMIN)
      tags:
      - users
  /users/{id}/ratings:
    get:
      parameters:
      - description: userId
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses: {}
      security:
      - BearerAuth: []
      summary: Listar ratings de un usuario (ADMIN)
      tags:
      - ratings
    post:
      consumes:
      - application/json
      parameters:
      - description: userId
        in: path
        name: id
        required: true
        type: integer
      - description: rating
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.ratingRequest'
      responses:
        "204":
          description: No Content
      security:
      - BearerAuth: []
      summary: Crear/actualizar rating (ADMIN)
      tags:
      - ratings
  /users/{id}/recommendations:
    get:
      parameters:
      - description: userId
        in: path
        name: id
        required: true
        type: integer
      - description: cantidad de recomendaciones (máx 50)
        in: query
        name: k
        type: integer
      - description: si true, ignora cache Redis
        in: query
        name: refresh
        type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.RecItem'
            type: array
      security:
      - BearerAuth: []
      summary: Recomendaciones para un usuario (ADMIN)
      tags:
      - recommend
  /users/{id}/update:
    put:
      consumes:
      - application/json
      description: Actualiza los datos de un usuario existente (email, role, password).
        Todos los campos son opcionales.
      parameters:
      - description: userId
        in: path
        name: id
        required: true
        type: integer
      - description: datos a actualizar
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.updateUserRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Actualizar usuario
      tags:
      - auth
  /users/{id}/ws/recommendations:
    get:
      parameters:
      - description: userId
        in: path
        name: id
        required: true
        type: integer
      - description: cantidad de recomendaciones (máx 50)
        in: query
        name: k
        type: integer
      - description: si true, ignora cache Redis
        in: query
        name: refresh
        type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
      security:
      - BearerAuth: []
      summary: Recomendaciones en tiempo real (WebSocket, ADMIN)
      tags:
      - recommend
securityDefinitions:
  BearerAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
